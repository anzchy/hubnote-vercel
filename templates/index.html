{% extends "base.html" %}

{% block title %}GitNote - ä»“åº“åˆ—è¡¨{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>GitHub ä»“åº“ç®¡ç†</h1>
        <p>æ·»åŠ  GitHub ä»“åº“ï¼ŒæŸ¥çœ‹å’Œç®¡ç† Issues</p>
    </div>

    <!-- æ·»åŠ ä»“åº“è¡¨å• -->
    <div class="add-repo-section">
        <h2>æ·»åŠ æ–°ä»“åº“</h2>
        <form method="POST" action="{{ url_for('add_repository') }}" class="add-repo-form">
            <div class="form-group">
                <input type="text" 
                       name="repo_url" 
                       placeholder="è¾“å…¥ GitHub ä»“åº“ URL æˆ– owner/repo æ ¼å¼"
                       class="form-input"
                       required>
                <button type="submit" class="btn btn-primary">æ·»åŠ ä»“åº“</button>
            </div>
            <div class="form-help">
                <p>æ”¯æŒæ ¼å¼ï¼š</p>
                <ul>
                    <li>https://github.com/owner/repo</li>
                    <li>owner/repo</li>
                </ul>
            </div>
        </form>
    </div>

    <!-- ä»“åº“åˆ—è¡¨ -->
    <div class="repos-section">
        <div class="section-header">
            <h2>å·²æ·»åŠ çš„ä»“åº“ ({{ repos|length }})</h2>
            {% if repos %}
            <button class="btn btn-primary" id="exportDataBtn">
                <span class="btn-icon">ğŸ“Š</span>
                å¯¼å‡ºæ•°æ®
            </button>
            {% endif %}
        </div>
        
        {% if repos %}
            <div class="repos-grid">
                {% for repo in repos %}
                <div class="repo-card">
                    <div class="repo-header">
                        <h3 class="repo-name">
                            <a href="{{ repo.url }}" target="_blank">{{ repo.full_name }}</a>
                        </h3>
                        <div class="repo-actions">
                            <a href="{{ url_for('repo_issues', repo_full_name=repo.full_name) }}" 
                               class="btn btn-sm btn-outline">æŸ¥çœ‹ Issues</a>
                            <a href="{{ url_for('remove_repository', repo_full_name=repo.full_name) }}" 
                               class="btn btn-sm btn-danger"
                               onclick="return confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»“åº“å—ï¼Ÿ')">åˆ é™¤</a>
                        </div>
                    </div>
                    
                    {% if repo.description %}
                    <p class="repo-description">{{ repo.description }}</p>
                    {% endif %}
                    
                    <div class="repo-stats">
                        <span class="stat-item">
                            <span class="stat-icon">â­</span>
                            {{ repo.stars }}
                        </span>
                        <span class="stat-item">
                            <span class="stat-icon">ğŸ´</span>
                            {{ repo.forks }}
                        </span>
                        <span class="stat-item">
                            <span class="stat-icon">ğŸ›</span>
                            {{ repo.open_issues }} Issues
                        </span>
                        {% if repo.language %}
                        <span class="stat-item">
                            <span class="stat-icon">ğŸ’»</span>
                            {{ repo.language }}
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="repo-meta">
                        <small class="text-muted">
                            æ·»åŠ äº {{ repo.added_at | datetime }}
                        </small>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">ğŸ“š</div>
                <h3>è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•ä»“åº“</h3>
                <p>æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ª GitHub ä»“åº“å¼€å§‹ä½¿ç”¨ GitNote</p>
            </div>
        {% endif %}
    </div>

    <!-- æ•°æ®å¯¼å‡ºæ¨¡æ€æ¡† -->
    <div id="exportModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>å¯¼å‡ºä»“åº“æ•°æ®</h3>
                <button class="modal-close" id="closeExportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="exportRepoSelect">é€‰æ‹©è¦å¯¼å‡ºçš„ä»“åº“ï¼š</label>
                    <select id="exportRepoSelect" class="form-select">
                        <option value="">è¯·é€‰æ‹©ä»“åº“...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="exportFormatSelect">é€‰æ‹©å¯¼å‡ºæ ¼å¼ï¼š</label>
                    <select id="exportFormatSelect" class="form-select">
                        <option value="json">JSON (å®Œæ•´æ•°æ®ç»“æ„)</option>
                        <option value="csv">CSV (Excel å…¼å®¹)</option>
                    </select>
                </div>
                <div class="export-info" id="exportInfo" style="display: none;">
                    <div class="info-item">
                        <strong>ä»“åº“æè¿°ï¼š</strong>
                        <span id="repoDescription">-</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelExportBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmExportBtn" disabled>
                    <span class="btn-icon">â¬‡ï¸</span>
                    å¼€å§‹å¯¼å‡º
                </button>
            </div>
        </div>
    </div>

    <!-- å¯¼å‡ºè¿›åº¦æç¤º -->
    <div id="exportProgress" class="progress-overlay" style="display: none;">
        <div class="progress-content">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨å¯¼å‡ºæ•°æ®ï¼Œè¯·ç¨å€™...</p>
            <small id="progressText">æ­£åœ¨è·å– Issues å’Œè¯„è®ºæ•°æ®</small>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/repo.js') }}"></script>
<script src="{{ url_for('static', filename='js/export.js') }}"></script>
{% endblock %}