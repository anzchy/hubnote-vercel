{% extends "base.html" %}

{% block title %}HubNote - 仓库列表{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>GitHub 仓库管理</h1>
        <p>添加 GitHub 仓库，查看和管理 Issues</p>
    </div>

    <!-- 添加仓库表单 -->
    <div class="add-repo-section">
        <h2>添加新仓库</h2>
        <form method="POST" action="{{ url_for('add_repository') }}" class="add-repo-form" id="add-repo-form">
            <div class="form-group">
                <input type="text" 
                       name="repo_url" 
                       placeholder="输入 GitHub 仓库 URL 或 owner/repo 格式"
                       class="form-input"
                       required>
                <button type="submit" class="btn btn-primary">添加仓库</button>
            </div>
            <div class="form-help">
                <p>支持格式：</p>
                <ul>
                    <li>https://github.com/owner/repo</li>
                    <li>owner/repo</li>
                </ul>
            </div>
        </form>
    </div>

    <!-- 仓库列表 -->
    <div class="repos-section">
        <div class="section-header">
            <h2>已添加的仓库 <span id="repo-count-badge">(0)</span></h2>
            <button class="btn btn-primary" id="exportDataBtn" style="display: none;">
                <span class="btn-icon">📊</span>
                导出数据
            </button>
        </div>
        
        <!-- 加载中状态 -->
        <div id="loading-state" class="loading-state">
            <div class="loading-spinner"></div>
            <p>正在加载仓库列表...</p>
        </div>
        
        <!-- 仓库网格容器 -->
        <div id="repos-grid" class="repos-grid" style="display: none;">
            <!-- JavaScript 将在这里插入仓库卡片 -->
        </div>
        
        <!-- 空状态 -->
        <div id="empty-state" class="empty-state" style="display: none;">
            <div class="empty-icon">📚</div>
            <h3>还没有添加任何仓库</h3>
            <p>添加你的第一个 GitHub 仓库开始使用 HubNote</p>
        </div>
    </div>

    <!-- 数据导出模态框 -->
    <div id="exportModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>导出仓库数据</h3>
                <button class="modal-close" id="closeExportModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="exportRepoSelect">选择要导出的仓库：</label>
                    <select id="exportRepoSelect" class="form-select">
                        <option value="">请选择仓库...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="exportFormatSelect">选择导出格式：</label>
                    <select id="exportFormatSelect" class="form-select">
                        <option value="json">JSON (完整数据结构)</option>
                        <option value="csv">CSV (Excel 兼容)</option>
                    </select>
                </div>
                <div class="export-info" id="exportInfo" style="display: none;">
                    <div class="info-item">
                        <strong>仓库描述：</strong>
                        <span id="repoDescription">-</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelExportBtn">取消</button>
                <button class="btn btn-primary" id="confirmExportBtn" disabled>
                    <span class="btn-icon">⬇️</span>
                    开始导出
                </button>
            </div>
        </div>
    </div>

    <!-- 导出进度提示 -->
    <div id="exportProgress" class="progress-overlay" style="display: none;">
        <div class="progress-content">
            <div class="loading-spinner"></div>
            <p>正在导出数据，请稍候...</p>
            <small id="progressText">正在获取 Issues 和评论数据</small>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/repo.js') }}"></script>
<script src="{{ url_for('static', filename='js/export.js') }}"></script>
{% endblock %}